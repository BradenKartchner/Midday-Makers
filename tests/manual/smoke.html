<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Smoke Test â€” App Entry</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 2em;
      }
      .pass {
        color: #2d7a2d;
      }
      .fail {
        color: #b30000;
      }
      .instructions {
        margin-bottom: 2em;
        background: #f8f8f8;
        padding: 1em;
        border-radius: 6px;
      }
      code {
        background: #eee;
        padding: 2px 4px;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <div class="instructions">
      <strong>How to Run:</strong>
      <ol>
        <li>
          Start a local server in your project folder:<br />
          <code>python3 -m http.server 8000</code>
        </li>
        <li>
          Open <code>http://localhost:8000/tests/manual/smoke.html</code> in
          Chrome.
        </li>
        <li>
          Check the Console (<code>Cmd+Option+I</code>) for PASS/FAIL messages.
        </li>
      </ol>
      <em>Works in latest Chrome; Firefox optional.</em>
    </div>
    <div id="smoke-results"></div>
    <script>
      // Track uncaught errors
      let uncaughtError = false;
      window.onerror = function (message) {
        uncaughtError = true;
        console.log('FAIL: Uncaught error:', message);
      };

      // Check if #app exists
      function checkAppMount() {
        const app = document.getElementById('app');
        if (app) {
          console.log('PASS: #app element found');
          return true;
        } else {
          console.log('FAIL: #app element not found');
          return false;
        }
      }

      // Check if categories.json loads
      async function checkCategoriesJson() {
        try {
          const res = await fetch('/data/categories.json');
          if (res.ok) {
            const data = await res.json();
            if (Array.isArray(data) && data.length > 0) {
              console.log('PASS: categories.json loaded');
              return true;
            } else {
              console.log(
                'FAIL: categories.json loaded but data is empty or invalid'
              );
              return false;
            }
          } else {
            console.log('FAIL: categories.json fetch failed');
            return false;
          }
        } catch (e) {
          console.log('FAIL: categories.json fetch error', e);
          return false;
        }
      }

      async function runSmokeTest() {
        window.addEventListener('DOMContentLoaded', async () => {
          const appMounted = checkAppMount();
          const categoriesLoaded = await checkCategoriesJson();
          const errorFree = !uncaughtError;

          const results = [
            appMounted
              ? '<span class="pass">PASS</span>: #app element found'
              : '<span class="fail">FAIL</span>: #app element not found',
            categoriesLoaded
              ? '<span class="pass">PASS</span>: categories.json loaded'
              : '<span class="fail">FAIL</span>: categories.json failed',
            errorFree
              ? '<span class="pass">PASS</span>: No uncaught errors'
              : '<span class="fail">FAIL</span>: Uncaught errors found',
          ];
          document.getElementById('smoke-results').innerHTML =
            results.join('<br>');
        });
      }

      runSmokeTest();
    </script>
  </body>
</html>
